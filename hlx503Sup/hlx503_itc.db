record(longout, "$(P)$(NAME)_ISOBUS") {
    field(DESC, "ISOBUS address of $(NAME)")
    field(VAL, "$(ISOBUS)")
}

# TEMP records

record(ai, "$(P)$(NAME):TEMP") {
    field(DESC, "Temp of $(NAME)")

    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP, "@hlx503_itc.proto get_temp($(ISOBUS),$(CHANNEL)) $(PORT)")

    field(PREC, "4")
    field(EGU, "K")
    
    info(INTEREST, "HIGH")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):TEMP")
    field(SDIS, "$(P)DISABLE")
}

record(ao, "$(P)$(NAME):TEMP:SP") {
    field(DESC, "Set temp of $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "stream")
    field(OUT, "@hlx503_itc.proto set_temp($(ISOBUS)) $(PORT)")

    field(PREC, "4")
    field(EGU, "K")
    
    info(INTEREST, "HIGH")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):TEMP:SP")
    field(SDIS, "$(P)DISABLE")
}

record(ai, "$(P)$(NAME):TEMP:SP:RBV") {
    field(DESC, "Temp set readback of $(NAME)")

    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP, "@hlx503_itc.proto get_temp_sp_rbv($(ISOBUS)) $(PORT)")

    field(PREC, "4")
    field(EGU, "K")
    
    info(INTEREST, "HIGH")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):TEMP:SP:RBV")
    field(SDIS, "$(P)DISABLE")
}

# Records filled from get_status

record(longin, "$(P)$(NAME):STATUS") {
    field(DESC, "Status of $(NAME)")

    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP, "@hlx503_itc.proto get_status($(P)$(NAME):,$(ISOBUS)) $(PORT)")

    info(INTEREST, "HIGH")
    info(archive, "VAL")
  
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):STATUS")
    field(SDIS, "$(P)DISABLE")
}

record(longin, "$(P)$(NAME):MODE") {
    field(DESC, "Autoheat, auto and init needlevalve")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(FLNK, "$(P)$(NAME):MODE:_FAN PP")
    
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):MODE")
    field(SDIS, "$(P)DISABLE")
}

record(fanout, "$(P)$(NAME):MODE:_FAN") {
    field(DESC, "Do processing of mode pvs")

    field(SELM, "All")
    field(LNK0, "$(P)$(NAME):AUTOHEAT:_CALC PP")
    field(LNK1, "$(P)$(NAME):AUTONEEDLEVALVE:_CALC PP")
    field(LNK2, "$(P)$(NAME):INITNEEDLEVALVE:_CALC PP")
}

record(calcout, "$(P)$(NAME):MODE:SP:_CALC") {
    field(DESC, "Calc set autoheat and autoneedlevalve")

    field(INPA, "$(P)$(NAME):AUTOHEAT:SP")
    field(INPB, "$(P)$(NAME):AUTONEEDLEVALVE:SP")
    field(CALC, "A + (B * 2)")
    field(OUT, "$(P)$(NAME):MODE:SP PP")
}

record(longout, "$(P)$(NAME):MODE:SP") {
    field(DESC, "Set autoheat and autoneedlevalve")

    field(SCAN, "Passive")
    field(DTYP, "stream")

    field(OUT, "@hlx503_itc.proto set_mode($(ISOBUS)) $(PORT)")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):MODE:SP")
    field(SDIS, "$(P)DISABLE")
}

record(bi, "$(P)$(NAME):AUTOHEAT") {
    field(DESC, "Heater manual or auto")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "Manual")
    field(ONAM, "Auto")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):AUTOHEAT")
    field(SDIS, "$(P)DISABLE")
}

record(calcout, "$(P)$(NAME):AUTOHEAT:_CALC") {
    field(DESC, "Calc whether autoheat is on")

    field(SCAN, "Passive")
    
    field(INPA, "$(P)$(NAME):MODE")
    field(CALC, "(A & 1) # 0")
    field(OUT, "$(P)$(NAME):AUTOHEAT PP")
}

record(bo, "$(P)$(NAME):AUTOHEAT:SP") {
    field(DESC, "Set heater to manual or auto")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "Manual")
    field(ONAM, "Auto")

    field(FLNK, "$(P)$(NAME):MODE:SP:_CALC PP")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):AUTOHEAT:SP")
    field(SDIS, "$(P)DISABLE")
}

record(bi, "$(P)$(NAME):AUTONEEDLEVALVE") {
    field(DESC, "Needle Valve manual or auto")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "Manual")
    field(ONAM, "Auto")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):AUTONEEDLEVALVE")
    field(SDIS, "$(P)DISABLE")
}

record(calcout, "$(P)$(NAME):AUTONEEDLEVALVE:_CALC") {
    field(DESC, "Calc whether autoneedlevalve is on")

    field(SCAN, "Passive")
    
    field(INPA, "$(P)$(NAME):MODE")
    field(CALC, "(A & 2) # 0")
    field(OUT, "$(P)$(NAME):AUTONEEDLEVALVE PP")
}

record(bo, "$(P)$(NAME):AUTONEEDLEVALVE:SP") {
    field(DESC, "Set needle Valve manual or auto")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "Manual")
    field(ONAM, "Auto")

    field(FLNK, "$(P)$(NAME):MODE:SP:_CALC PP")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):AUTONEEDLEVALVE:SP")
    field(SDIS, "$(P)DISABLE")
}

record(bi, "$(P)$(NAME):INITNEEDLEVALVE") {
    field(DESC, "Needle Valve initialising")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "NO")
    field(ONAM, "YES")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):INITNEEDLEVALVE")
    field(SDIS, "$(P)DISABLE")
}

record(calcout, "$(P)$(NAME):INITNEEDLEVALVE:_CALC") {
    field(DESC, "Calc whether needle valve initialising")

    field(SCAN, "Passive")
    
    field(INPA, "$(P)$(NAME):MODE")
    field(CALC, "(A & 4) # 0")
    field(OUT, "$(P)$(NAME):INITNEEDLEVALVE PP")
}

record(longin, "$(P)$(NAME):CTRL") {
    field(DESC, "Control status of $(NAME)")

    field(DTYP, "Soft Channel")

    field(FLNK, "$(P)$(NAME):CTRL:_FAN PP")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):CTRL")
    field(SDIS, "$(P)DISABLE")
}

record(fanout, "$(P)$(NAME):CTRL:_FAN") {
    field(DESC, "Do processing of ctrl pvs")

    field(SELM, "All")
    field(LNK0, "$(P)$(NAME):REMOTE:_CALC PP")
    field(LNK1, "$(P)$(NAME):LOCKED:_CALC PP")
}

record(longout, "$(P)$(NAME):CTRL:SP") {
    field(DESC, "Set control status of $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "stream")

    field(OUT, "@hlx503_itc.proto set_ctrl($(ISOBUS)) $(PORT)")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):CTRL:SP")
    field(SDIS, "$(P)DISABLE")
}

record(calcout, "$(P)$(NAME):CTRL:SP:_CALC") {
    field(DESC, "Calc set remote and locked")

    field(INPA, "$(P)$(NAME):REMOTE:SP")
    field(INPB, "$(P)$(NAME):LOCKED:SP")
    field(CALC, "A + (B * 2)")
    field(OUT, "$(P)$(NAME):CTRL:SP PP")
}

record(bi, "$(P)$(NAME):REMOTE") {
    field(DESC, "Is $(NAME) in remote mode")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "NO")
    field(ONAM, "YES")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):REMOTE")
    field(SDIS, "$(P)DISABLE")
}

record(calcout, "$(P)$(NAME):REMOTE:_CALC") {
    field(DESC, "Calc whether in remote")

    field(SCAN, "Passive")
    
    field(INPA, "$(P)$(NAME):CTRL")
    field(CALC, "A & 1")

    field(OUT, "$(P)$(NAME):REMOTE PP")
}

record(bo, "$(P)$(NAME):REMOTE:SP") {
    field(DESC, "Set $(NAME) remote mode")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "NO")
    field(ONAM, "YES")

    field(FLNK, "$(P)$(NAME):CTRL:SP:_CALC PP")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):REMOTE:SP")
    field(SDIS, "$(P)DISABLE")
}

record(bi, "$(P)$(NAME):LOCKED") {
    field(DESC, "Is $(NAME) locked")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "NO")
    field(ONAM, "YES")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):LOCKED")
    field(SDIS, "$(P)DISABLE")
}

record(calcout, "$(P)$(NAME):LOCKED:_CALC") {
    field(DESC, "Calc whether locked")

    field(SCAN, "Passive")
    
    field(INPA, "$(P)$(NAME):CTRL")
    field(CALC, "(A & 2) = 0")
    field(OUT, "$(P)$(NAME):LOCKED PP")
}

record(bi, "$(P)$(NAME):LOCKED:SP") {
    field(DESC, "Set whether $(NAME) locked")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "NO")
    field(ONAM, "YES")

    field(FLNK, "$(P)$(NAME):CTRL:SP:_CALC PP")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):LOCKED:SP")
    field(SDIS, "$(P)DISABLE")
}

record(bi, "$(P)$(NAME):SWEEPING") {
    field(DESC, "Whether sweeping")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "NO")
    field(ONAM, "YES")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):SWEEPING")
    field(SDIS, "$(P)DISABLE")
}

record(stringin, "$(P)$(NAME):CTRLCHANNEL:_TEMP") {
    field(DESC, "Store TEMP string of CTRLCHANNEL")

    field(SCAN, "Passive")
    field(DTYP,  "Soft Channel")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):CTRLCHANNEL:_TEMP")
    field(SDIS, "$(P)DISABLE")
}

record(scalcout, "$(P)$(NAME):CTRLCHANNEL:_CALC") {
    field(DESC, "Calc CTRLCHANNEL from OPTIONALS")

    field(INAA, "$(P)$(NAME):CTRLCHANNEL:_TEMP CP MS")
    field(CALC, "AA # '' ? INT(AA-'H') : 0")
    field(OUT, "$(P)$(NAME):CTRLCHANNEL PP")
}

record(longin, "$(P)$(NAME):CTRLCHANNEL") {
    field(DESC, "Control channel of $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
  
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):CTRLCHANNEL")
    field(SDIS, "$(P)DISABLE")
}

record(longout, "$(P)$(NAME):CTRLCHANNEL:SP") {
    field(DESC, "Set control channel of $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "stream")

    field(OUT, "@hlx503_itc.proto set_ctrlchannel($(ISOBUS)) $(PORT)")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
  
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):CTRLCHANNEL:SP")
    field(SDIS, "$(P)DISABLE")
}

record(stringin, "$(P)$(NAME):AUTOPID:_TEMP") {
    field(DESC, "Store TEMP string of AUTOPID")

    field(SCAN, "Passive")
    field(DTYP,  "Soft Channel")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):AUTOPID:_TEMP")
    field(SDIS, "$(P)DISABLE")
}

record(scalcout, "$(P)$(NAME):AUTOPID:_CALC") {
    field(DESC, "Calc AUTOPID from _TEMP")

    field(INAA, "$(P)$(NAME):AUTOPID:_TEMP CP MS")
    field(CALC, "AA = 'L1' ? 'ON' : 'OFF'")
    field(OUT, "$(P)$(NAME):AUTOPID PP")
}

record(bi, "$(P)$(NAME):AUTOPID") {
    field(DESC, "Automatic PID of $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "OFF")
    field(ONAM, "ON")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):AUTOPID")
    field(SDIS, "$(P)DISABLE")
}

record(bo, "$(P)$(NAME):AUTOPID:SP") {
    field(DESC, "Automatic PID setpoint of $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "stream")

    field(OUT, "@hlx503_itc.proto set_autopid($(ISOBUS)) $(PORT)")

    field(ZNAM, "OFF")
    field(ONAM, "ON")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):AUTOPID:SP")
    field(SDIS, "$(P)DISABLE")
}

record(stringin, "$(P)$(NAME):TUNING:_TEMP") {
    field(DESC, "Store TEMP string of TUNING")

    field(SCAN, "Passive")
    field(DTYP,  "Soft Channel")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):TUNING:_TEMP")
    field(SDIS, "$(P)DISABLE")
}

record(scalcout, "$(P)$(NAME):TUNING:_CALC") {
    field(DESC, "Calc TUNING from _TEMP")

    field(INAA, "$(P)$(NAME):TUNING:_TEMP CP MS")
    field(CALC, "AA = 'N1' ? 'YES' : 'NO'")
    field(OUT, "$(P)$(NAME):TUNING PP")
}

record(bi, "$(P)$(NAME):TUNING") {
    field(DESC, "Whether tuning")

    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")

    field(ZNAM, "NO")
    field(ONAM, "YES")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):TUNING")
    field(SDIS, "$(P)DISABLE")
}

# PID Settings

record(ao, "$(P)$(NAME):P:SP") {
    field(DESC, "Proportional for $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "stream")

    field(OUT, "@hlx503_itc.proto set_proportional($(ISOBUS)) $(PORT)")

    field(PREC, "4")
    field(EGU, "% of span")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):P:SP")
    field(SDIS, "$(P)DISABLE")
}

record(ao, "$(P)$(NAME):I:SP") {
    field(DESC, "Integral for $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "stream")

    field(OUT, "@hlx503_itc.proto set_integral($(ISOBUS)) $(PORT)")

    field(PREC, "1")
    field(EGU, "min")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):I:SP")
    field(SDIS, "$(P)DISABLE")
}

record(ao, "$(P)$(NAME):D:SP") {
    field(DESC, "Derivative for $(NAME)")

    field(SCAN, "Passive")
    field(DTYP, "stream")

    field(OUT, "@hlx503_itc.proto set_derivative($(ISOBUS)) $(PORT)")

    field(PREC, "4")
    field(EGU, "min")

    info(INTEREST, "MEDIUM")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:$(NAME):D:SP")
    field(SDIS, "$(P)DISABLE")
}
